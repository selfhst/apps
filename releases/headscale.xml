<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <id>https://selfh.st/apps</id>
  <title>Headscale Releases</title>
  <updated>2025-02-23T19:30:30.816194-05:00</updated>
  <author>
    <name>selfh.st</name>
    <email>contact@selfh.st</email>
  </author>
  <link href="https://selfh.st/apps" rel="alternate"/>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <subtitle>Self-hosted software releases generated by selfh.st</subtitle>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.24.0</id>
    <title>New release for Headscale: v0.24.0</title>
    <updated>2025-01-17T06:58:05-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;Security fix: OIDC changes in Headscale 0.24.0&lt;/h3&gt;
&lt;p&gt;The following issue &lt;em&gt;only&lt;/em&gt; affects Headscale installations which authenticate
with OIDC.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Headscale v0.23.0 and earlier&lt;/em&gt; identified OIDC users by the "username" part of
their email address (when &lt;code&gt;strip_email_domain: true&lt;/code&gt;, the default) or whole
email address (when &lt;code&gt;strip_email_domain: false&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Depending on how Headscale and your Identity Provider (IdP) were configured,
only using the &lt;code&gt;email&lt;/code&gt; claim could allow a malicious user with an IdP account to
take over another Headscale user's account, even when
&lt;code&gt;strip_email_domain: false&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This would also cause a user to lose access to their Headscale account if they
changed their email address.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Headscale v0.24.0&lt;/em&gt; now identifies OIDC users by the &lt;code&gt;iss&lt;/code&gt; and &lt;code&gt;sub&lt;/code&gt; claims.
&lt;a href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimStability"&gt;These are guaranteed by the OIDC specification to be stable and unique&lt;/a&gt;,
even if a user changes email address. A well-designed IdP will typically set
&lt;code&gt;sub&lt;/code&gt; to an opaque identifier like a UUID or numeric ID, which has no relation
to the user's name or email address.&lt;/p&gt;
&lt;p&gt;Headscale v0.24.0 and later will also automatically update profile fields with
OIDC data on login. This means that users can change those details in your IdP,
and have it populate to Headscale automatically the next time they log in.
However, this may affect the way you reference users in policies.&lt;/p&gt;
&lt;p&gt;Headscale v0.23.0 and earlier never recorded the &lt;code&gt;iss&lt;/code&gt; and &lt;code&gt;sub&lt;/code&gt; fields, so all
legacy (existing) OIDC accounts &lt;em&gt;need to be migrated&lt;/em&gt; to be properly
secured.&lt;/p&gt;
&lt;h4&gt;What do I need to do to migrate?&lt;/h4&gt;
&lt;p&gt;Headscale v0.24.0 has an automatic migration feature, which is enabled by
default (&lt;code&gt;map_legacy_users: true&lt;/code&gt;). &lt;strong&gt;This will be disabled by default in a
future version of Headscale – any unmigrated users will get new accounts.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The migration will mostly be done automatically, with one exception. If your
OIDC does not provide an &lt;code&gt;email_verified&lt;/code&gt; claim, Headscale will ignore the
&lt;code&gt;email&lt;/code&gt;. This means that either the administrator will have to mark the user
emails as verified, or ensure the users verify their emails. Any unverified
emails will be ignored, meaning that the users will get new accounts instead
of being migrated.&lt;/p&gt;
&lt;p&gt;After this exception is ensured, make all users log into Headscale with their
account, and Headscale will automatically update the account record. This will
be transparent to the users.&lt;/p&gt;
&lt;p&gt;When all users have logged in, you can disable the automatic migration by
setting &lt;code&gt;map_legacy_users: false&lt;/code&gt; in your configuration file.&lt;/p&gt;
&lt;p&gt;Please note that &lt;code&gt;map_legacy_users&lt;/code&gt; will be set to &lt;code&gt;false&lt;/code&gt; by default in v0.25.0
and the migration mechanism will be removed in v0.26.0.&lt;/p&gt;
&lt;details&gt;

&lt;summary&gt;What does automatic migration do?&lt;/summary&gt;

##### What does automatic migration do?

When automatic migration is enabled (`map_legacy_users: true`), Headscale will
first match an OIDC account to a Headscale account by `iss` and `sub`, and then
fall back to matching OIDC users similarly to how Headscale v0.23.0 did:

- If `strip_email_domain: true` (the default): the Headscale username matches
  the "username" part of their email address.
- If `strip_email_domain: false`: the Headscale username matches the _whole_
  email address.

On migration, Headscale will change the account's username to their
`preferred_username`. **This could break any ACLs or policies which are
configured to match by username.**

Like with Headscale v0.23.0 and earlier, this migration only works for users who
haven't changed their email address since their last Headscale login.

A _successful_ automated migration should otherwise be transparent to users.

Once a Headscale account has been migrated, it will be _unavailable_ to be
matched by the legacy process. An OIDC login with a matching username, but
_non-matching_ `iss` and `sub` will instead get a _new_ Headscale account.

Because of the way OIDC works, Headscale's automated migration process can
_only_ work when a user tries to log in after the update.

Legacy account migration should have no effect on new installations where all
users have a recorded `sub` and `iss`.

&lt;/details&gt;

&lt;details&gt;

&lt;summary&gt;What happens when automatic migration is disabled?&lt;/summary&gt;

##### What happens when automatic migration is disabled?

When automatic migration is disabled (`map_legacy_users: false`), Headscale will
only try to match an OIDC account to a Headscale account by `iss` and `sub`.

If there is no match, it will get a _new_ Headscale account – even if there was
a legacy account which _could_ have matched and migrated.

We recommend new Headscale users explicitly disable automatic migration – but it
should otherwise have no effect if every account has a recorded `iss` and `sub`.

When automatic migration is disabled, the `strip_email_domain` setting will have
no effect.

&lt;/details&gt;

&lt;p&gt;Special thanks to @micolous for reviewing, proposing and working with us on
these changes.&lt;/p&gt;
&lt;h4&gt;Other OIDC changes&lt;/h4&gt;
&lt;p&gt;Headscale now uses
&lt;a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims"&gt;the standard OIDC claims&lt;/a&gt;
to populate and update user information every time they log in:&lt;/p&gt;
&lt;p&gt;| Headscale profile field | OIDC claim           | Notes / examples                                                                                          |
| ----------------------- | -------------------- | --------------------------------------------------------------------------------------------------------- |
| email address           | &lt;code&gt;email&lt;/code&gt;              | Only used when &lt;code&gt;"email_verified": true&lt;/code&gt;                                                                   |
| display name            | &lt;code&gt;name&lt;/code&gt;               | eg: &lt;code&gt;Sam Smith&lt;/code&gt;                                                                                           |
| username                | &lt;code&gt;preferred_username&lt;/code&gt; | Varies depending on IdP and configuration, eg: &lt;code&gt;ssmith&lt;/code&gt;, &lt;code&gt;ssmith@idp.example.com&lt;/code&gt;, &lt;code&gt;\\example.com\ssmith&lt;/code&gt; |
| profile picture         | &lt;code&gt;picture&lt;/code&gt;            | URL to a profile picture or avatar                                                                        |&lt;/p&gt;
&lt;p&gt;These should show up nicely in the Tailscale client.&lt;/p&gt;
&lt;p&gt;This will also affect the way you
&lt;a href="https://github.com/juanfont/headscale/pull/2205"&gt;reference users in policies&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;BREAKING&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Remove &lt;code&gt;dns.use_username_in_magic_dns&lt;/code&gt; configuration option
  &lt;a href="https://github.com/juanfont/headscale/pull/2020"&gt;#2020&lt;/a&gt;,
  &lt;a href="https://github.com/juanfont/headscale/pull/2279"&gt;#2279&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Having usernames in magic DNS is no longer possible.&lt;/li&gt;
&lt;li&gt;Remove versions older than 1.56
  &lt;a href="https://github.com/juanfont/headscale/pull/2149"&gt;#2149&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clean up old code required by old versions&lt;/li&gt;
&lt;li&gt;User gRPC/API &lt;a href="https://github.com/juanfont/headscale/pull/2261"&gt;#2261&lt;/a&gt;:&lt;/li&gt;
&lt;li&gt;If you depend on a Headscale Web UI, you should wait with this update until
    the UI have been updated to match the new API.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GET /api/v1/user/{name}&lt;/code&gt; and &lt;code&gt;GetUser&lt;/code&gt; have been removed in favour of &lt;code&gt;ListUsers&lt;/code&gt; with an ID parameter&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RenameUser&lt;/code&gt; and &lt;code&gt;DeleteUser&lt;/code&gt; now require an ID instead of a name.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Improved compatibility of built-in DERP server with clients connecting over
  WebSocket &lt;a href="https://github.com/juanfont/headscale/pull/2132"&gt;#2132&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Allow nodes to use SSH agent forwarding
  &lt;a href="https://github.com/juanfont/headscale/pull/2145"&gt;#2145&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed processing of fields in post request in MoveNode rpc
  &lt;a href="https://github.com/juanfont/headscale/pull/2179"&gt;#2179&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Added conversion of 'Hostname' to 'givenName' in a node with FQDN rules
  applied &lt;a href="https://github.com/juanfont/headscale/pull/2198"&gt;#2198&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed updating of hostname and givenName when it is updated in HostInfo
  &lt;a href="https://github.com/juanfont/headscale/pull/2199"&gt;#2199&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed missing &lt;code&gt;stable-debug&lt;/code&gt; container tag
  &lt;a href="https://github.com/juanfont/headscale/pull/2232"&gt;#2232&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Loosened up &lt;code&gt;server_url&lt;/code&gt; and &lt;code&gt;base_domain&lt;/code&gt; check. It was overly strict in some
  cases. &lt;a href="https://github.com/juanfont/headscale/pull/2248"&gt;#2248&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CLI for managing users now accepts &lt;code&gt;--identifier&lt;/code&gt; in addition to &lt;code&gt;--name&lt;/code&gt;,
  usage of &lt;code&gt;--identifier&lt;/code&gt; is recommended
  &lt;a href="https://github.com/juanfont/headscale/pull/2261"&gt;#2261&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add &lt;code&gt;dns.extra_records_path&lt;/code&gt; configuration option &lt;a href="https://github.com/juanfont/headscale/issues/2262"&gt;#2262&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Support client verify for DERP &lt;a href="https://github.com/juanfont/headscale/pull/2046"&gt;#2046&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add PKCE Verifier for OIDC &lt;a href="https://github.com/juanfont/headscale/pull/2314"&gt;#2314&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ede4f97a16b0b2d357d3584431e9feb34d43fc89 Fix typos&lt;/li&gt;
&lt;li&gt;fa641e38b8a62ad665e15370a2b29a48c6486060 Set CSRF cookies for OIDC (#2328)&lt;/li&gt;
&lt;li&gt;1ab7b315a2707434b67cd83f28c6322a3c24b4c4 Update apple.md for latest version of iOS (#2321)&lt;/li&gt;
&lt;li&gt;38aef77e5419f7cc28f525226ed9567fe16dd166 allow @ and Log if OIDC username is not consider valid (#2340)&lt;/li&gt;
&lt;li&gt;b81420bef1e8d042f5bc126565c70b58f7321900 feat: Add PKCE Verifier for OIDC (#2314)&lt;/li&gt;
&lt;li&gt;caad5c613d90a11de1db4b93da69fa352a35c226 fix nil pointer deref (#2339)&lt;/li&gt;
&lt;li&gt;9313e5b058cb161927708e47622ef2bdef0ab9dc flake.lock: Update (#2313)&lt;/li&gt;
&lt;li&gt;f9bbfa5eabcbb0dc10866aada42f02a3602e1a8e flake.lock: Update (#2320)&lt;/li&gt;
&lt;li&gt;41bad2b9fdac7171e68babce0b6b045316d298f3 flake.lock: Update (#2324)&lt;/li&gt;
&lt;li&gt;610597bfb74145626a9169a11bc4ad7145246660 flake.lock: Update (#2342)&lt;/li&gt;
&lt;li&gt;e88406e8379691cae00fa82afbf52ecfacd5d292 set changelog date (#2347)&lt;/li&gt;
&lt;li&gt;e4a3dcc3b884bc5f37775df04389cba04bb5990b use headscale server url as domain instead of base_domain (#2338)&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.24.0" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.24.1</id>
    <title>New release for Headscale: v0.24.1</title>
    <updated>2025-01-23T10:58:42-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Fix migration issue with user table for PostgreSQL
  &lt;a href="https://github.com/juanfont/headscale/pull/2367"&gt;#2367&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Relax username validation to allow emails
  &lt;a href="https://github.com/juanfont/headscale/pull/2364"&gt;#2364&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Remove invalid routes and add stronger constraints for routes to avoid API panic
  &lt;a href="https://github.com/juanfont/headscale/pull/2371"&gt;#2371&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix panic when &lt;code&gt;derp.update_frequency&lt;/code&gt; is 0
  &lt;a href="https://github.com/juanfont/headscale/pull/2368"&gt;#2368&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;6cd8d993941dbab7ed32cd21c8b62174b7dc7099 fix panic if derp update is 0 (#2368)&lt;/li&gt;
&lt;li&gt;84431f2759f76b414368c9d4587ff27e14c6149c fix postgres migration issue with 0.24 (#2367)&lt;/li&gt;
&lt;li&gt;5164b2766b2badb3b92ff6a137312cef4763f151 make it harder to insert invalid routes (#2371)&lt;/li&gt;
&lt;li&gt;479f79912621674f6f1c07dd40473b9971faf1d9 relax user validation to allow emails, add tests from various oidc providers (#2364)&lt;/li&gt;
&lt;li&gt;f22a48bcfef3cd037dee905a6feacc52a3a67068 set date for 0.24.1 release&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.24.1" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.24.2</id>
    <title>New release for Headscale: v0.24.2</title>
    <updated>2025-01-30T09:11:26-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Fix issue where email and username being equal fails to match in Policy
  &lt;a href="https://github.com/juanfont/headscale/pull/2388"&gt;#2388&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Delete invalid routes before adding a NOT NULL constraint on node_id
  &lt;a href="https://github.com/juanfont/headscale/pull/2386"&gt;#2386&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;341a3d3005c1b083094e433999aa9eb63b569f01 Remove routes without a node_id (#2386)&lt;/li&gt;
&lt;li&gt;46b82269e024bb6f275989cca9bd055651c7c64c simplify findUserByToken in ACL, add missing testcases (#2388)&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.24.2" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.24.3</id>
    <title>New release for Headscale: v0.24.3</title>
    <updated>2025-02-07T05:35:20-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Fix migration error caused by nodes having invalid auth keys
  &lt;a href="https://github.com/juanfont/headscale/pull/2412"&gt;#2412&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pre auth keys belonging to a user are no longer deleted with the user
  &lt;a href="https://github.com/juanfont/headscale/pull/2396"&gt;#2396&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pre auth keys that are used by a node can no longer be deleted
  &lt;a href="https://github.com/juanfont/headscale/pull/2396"&gt;#2396&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ffe2f299cb02588a8425753c8b10f57b36726ed1 do not allow preauth keys to be deleted if assigned to node (#2396)&lt;/li&gt;
&lt;li&gt;3b55dacda108da89011910d47bd913135683214c hscontrol/db: add migration setting non existing pak on nodes to null (#2412)&lt;/li&gt;
&lt;li&gt;1e2419bc032e9a8bf227eda2c9443c7926104d5c update changelog&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.24.3" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.25.0</id>
    <title>New release for Headscale: v0.25.0</title>
    <updated>2025-02-11T07:16:41-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;BREAKING&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Authentication flow has been rewritten
  &lt;a href="https://github.com/juanfont/headscale/pull/2374"&gt;#2374&lt;/a&gt; This change should be
  transparent to users with the exception of some buxfixes that has been
  discovered and was fixed as part of the rewrite.&lt;/li&gt;
&lt;li&gt;When a node is registered with &lt;em&gt;a new user&lt;/em&gt;, it will be registered as a new
    node (&lt;a href="https://github.com/juanfont/headscale/issues/2327"&gt;#2327&lt;/a&gt; and
    &lt;a href="https://github.com/juanfont/headscale/issues/1310"&gt;#1310&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;A logged out node logging in with the same user will replace the existing
    node.&lt;/li&gt;
&lt;li&gt;Remove support for Tailscale clients older than 1.62 (Capability version 87)
      &lt;a href="https://github.com/juanfont/headscale/pull/2405"&gt;#2405&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;oidc.map_legacy_users&lt;/code&gt; is now &lt;code&gt;false&lt;/code&gt; by default
  &lt;a href="https://github.com/juanfont/headscale/pull/2350"&gt;#2350&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Print Tailscale version instead of capability versions for outdated nodes
  &lt;a href="https://github.com/juanfont/headscale/pull/2391"&gt;#2391&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Do not allow renaming of users from OIDC
  &lt;a href="https://github.com/juanfont/headscale/pull/2393"&gt;#2393&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Change minimum hostname length to 2
  &lt;a href="https://github.com/juanfont/headscale/pull/2393"&gt;#2393&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix migration error caused by nodes having invalid auth keys
  &lt;a href="https://github.com/juanfont/headscale/pull/2412"&gt;#2412&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pre auth keys belonging to a user are no longer deleted with the user
  &lt;a href="https://github.com/juanfont/headscale/pull/2396"&gt;#2396&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pre auth keys that are used by a node can no longer be deleted
  &lt;a href="https://github.com/juanfont/headscale/pull/2396"&gt;#2396&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Rehaul HTTP errors, return better status code and errors to users
  &lt;a href="https://github.com/juanfont/headscale/pull/2398"&gt;#2398&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;d5037c25a6a663cc908e5eba65a0f24e240d3d9a date in changelog&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.25.0" rel="alternate"/>
  </entry>
</feed>
