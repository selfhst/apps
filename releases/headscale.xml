<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <id>https://selfh.st/apps</id>
  <title>Headscale Releases</title>
  <updated>2025-01-18T18:30:47.334419-05:00</updated>
  <author>
    <name>selfh.st</name>
    <email>contact@selfh.st</email>
  </author>
  <link href="https://selfh.st/apps" rel="alternate"/>
  <generator uri="https://lkiesow.github.io/python-feedgen" version="0.9.0">python-feedgen</generator>
  <subtitle>Self-hosted software releases generated by selfh.st</subtitle>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.22.1</id>
    <title>New release for Headscale: v0.22.1</title>
    <updated>2023-04-20T10:04:59-04:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h2&gt;Changelog&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;a5afe4b Add more capabilities for systemd&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.22.1" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.22.2</id>
    <title>New release for Headscale: v0.22.2</title>
    <updated>2023-05-11T02:07:41-04:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h2&gt;Changelog&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Add environment flags to enable pprof (profiling) &lt;a href="https://github.com/juanfont/headscale/pull/1382"&gt;#1382&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Profiles are continously generated in our integration tests.&lt;/li&gt;
&lt;li&gt;Fix systemd service file location in &lt;code&gt;.deb&lt;/code&gt; packages &lt;a href="https://github.com/juanfont/headscale/pull/1391"&gt;#1391&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Improvements on Noise implementation &lt;a href="https://github.com/juanfont/headscale/pull/1379"&gt;#1379&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Replace node filter logic, ensuring nodes with access can see eachother &lt;a href="https://github.com/juanfont/headscale/pull/1381"&gt;#1381&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Disable (or delete) both exit routes at the same time &lt;a href="https://github.com/juanfont/headscale/pull/1428"&gt;#1428&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Ditch distroless for Docker image, create default socket dir in &lt;code&gt;/var/run/headscale&lt;/code&gt; &lt;a href="https://github.com/juanfont/headscale/pull/1450"&gt;#1450&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Commits&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;00c5146 Add IP forwarding requirement to documentation&lt;/li&gt;
&lt;li&gt;1a7ae11 Add basic testcases for Machine.canAccess&lt;/li&gt;
&lt;li&gt;56dd734 Add go profiling flag, and enable on integration tests (#1382)&lt;/li&gt;
&lt;li&gt;f113cc7 Add missing GH releases page link&lt;/li&gt;
&lt;li&gt;eacd687 Added DERP integration tests&lt;/li&gt;
&lt;li&gt;9478c28 Added missing file&lt;/li&gt;
&lt;li&gt;997e934 Added web ui section&lt;/li&gt;
&lt;li&gt;991ff25 Added workflow for embedded derp&lt;/li&gt;
&lt;li&gt;f73354b Create default sock path in Docker&lt;/li&gt;
&lt;li&gt;02ab0df Disable and Delete route must affect both exit routes (IPv4 and IPv6)&lt;/li&gt;
&lt;li&gt;4c8f8c6 Ditch distroless for Docker image&lt;/li&gt;
&lt;li&gt;b465592 Do not use host networking in embedded DERP tests&lt;/li&gt;
&lt;li&gt;549f5a1 Expand surface of hsic for better TLS support&lt;/li&gt;
&lt;li&gt;bb07aec Expand tsic to offer PingViaDerp&lt;/li&gt;
&lt;li&gt;df72508 Fix : Change master branch to main&lt;/li&gt;
&lt;li&gt;0f8d8fc Fix : Updating the doc path&lt;/li&gt;
&lt;li&gt;a2b7608 Fix extra space&lt;/li&gt;
&lt;li&gt;f60c5a1 Fix socket location in config.go&lt;/li&gt;
&lt;li&gt;bab4e14 Further clarification on unsupported ranges in config example&lt;/li&gt;
&lt;li&gt;7338775 Give a warning when users have set an unsupported prefix&lt;/li&gt;
&lt;li&gt;dcf2439 Improved website&lt;/li&gt;
&lt;li&gt;8077203 Improvements on Noise implementation (#1379)&lt;/li&gt;
&lt;li&gt;a45777d Put systemd service file in proper location&lt;/li&gt;
&lt;li&gt;1d2b4bc Remove legacy DERP tests&lt;/li&gt;
&lt;li&gt;96f9680 Reuse Ping function for DERP ping&lt;/li&gt;
&lt;li&gt;5706f84 Revert "Revert unix_socket to default value"&lt;/li&gt;
&lt;li&gt;ca54fb9 Revert unix_socket to default value&lt;/li&gt;
&lt;li&gt;57fd5cf Update CHANGELOG.md&lt;/li&gt;
&lt;li&gt;744e5a1 Update CHANGELOG.md&lt;/li&gt;
&lt;li&gt;3ea1750 Update CHANGELOG.md&lt;/li&gt;
&lt;li&gt;6c5723a Update CHANGELOG.md&lt;/li&gt;
&lt;li&gt;526e568 Update changelog&lt;/li&gt;
&lt;li&gt;c7db99d Update changelog + prepare for 0.22.2&lt;/li&gt;
&lt;li&gt;9f38125 Update config.go&lt;/li&gt;
&lt;li&gt;493bcfc Update mkdocs.yml&lt;/li&gt;
&lt;li&gt;6043ec8 Update mkdocs.yml&lt;/li&gt;
&lt;li&gt;22e397e Use common path in unix_socket default setting&lt;/li&gt;
&lt;li&gt;ccedf27 add a filter case with really large destination set #1372&lt;/li&gt;
&lt;li&gt;5bbbe43 clear up the acl function naming&lt;/li&gt;
&lt;li&gt;10320a5 lint and nolint tailscale borrowed func&lt;/li&gt;
&lt;li&gt;200e3b8 make generateFilterRule a pol struct func&lt;/li&gt;
&lt;li&gt;644be82 move matcher to separate file&lt;/li&gt;
&lt;li&gt;d011373 optimize generateACLPeerCacheMap (#1377)&lt;/li&gt;
&lt;li&gt;1700a74 outline tests for full filter generate&lt;/li&gt;
&lt;li&gt;ecd62fb remove terrible filter code&lt;/li&gt;
&lt;li&gt;6de53e2 simplify expandAlias function, move seperate logic out&lt;/li&gt;
&lt;li&gt;889d5a1 testing without that horrible filtercode&lt;/li&gt;
&lt;li&gt;b23a915 trim dockerfiles, script to rebuild test images (#1403)&lt;/li&gt;
&lt;li&gt;0d24e87 update flake hash&lt;/li&gt;
&lt;li&gt;6215eb6 update flake hash (#1376)&lt;/li&gt;
&lt;li&gt;ba45d7d update readme and templates to clarify scope (#1437)&lt;/li&gt;
&lt;li&gt;735b185 use IPSet in acls instead of string slice&lt;/li&gt;
&lt;li&gt;56b63c6 use netipx.IPSet for matcher&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.22.2" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.22.3</id>
    <title>New release for Headscale: v0.22.3</title>
    <updated>2023-05-12T04:26:06-04:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h2&gt;Changelog&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Added missing ca-certificates in Docker image &lt;a href="https://github.com/juanfont/headscale/pull/1463"&gt;#1463&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.22.3" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.23.0</id>
    <title>New release for Headscale: v0.23.0</title>
    <updated>2024-09-18T04:56:54-04:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;p&gt;This release was intended to be mainly a code reorganisation and refactoring, significantly improving the maintainability of the codebase. This should allow us to improve further and make it easier for the maintainers to keep on top of the project.
However, as you all have noticed, it turned out to become a much larger, much longer release cycle than anticipated. It has ended up to be a release with a lot of rewrites and changes to the code base and functionality of Headscale, cleaning up a lot of technical debt and introducing a lot of improvements. This does come with some breaking changes,&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Please remember to always back up your database between versions&lt;/strong&gt;&lt;/p&gt;
&lt;h4&gt;Here is a short summary of the broad topics of changes:&lt;/h4&gt;
&lt;p&gt;Code has been organised into modules, reducing use of global variables/objects, isolating concerns and “putting the right things in the logical place”.&lt;/p&gt;
&lt;p&gt;The new &lt;a href="https://github.com/juanfont/headscale/tree/main/hscontrol/policy"&gt;policy&lt;/a&gt; and &lt;a href="https://github.com/juanfont/headscale/tree/main/hscontrol/mapper"&gt;mapper&lt;/a&gt; package, containing the ACL/Policy logic and the logic for creating the data served to clients (the network “map”) has been rewritten and improved. This change has allowed us to finish SSH support and add additional tests throughout the code to ensure correctness.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/juanfont/headscale/blob/main/hscontrol/poll.go"&gt;“poller”, or streaming logic&lt;/a&gt; has been rewritten and instead of keeping track of the latest updates, checking at a fixed interval, it now uses go channels, implemented in our new &lt;a href="https://github.com/juanfont/headscale/tree/main/hscontrol/notifier"&gt;notifier&lt;/a&gt; package and it allows us to send updates to connected clients immediately. This should both improve performance and potential latency before a client picks up an update.&lt;/p&gt;
&lt;p&gt;Headscale now supports sending “delta” updates, thanks to the new mapper and poller logic, allowing us to only inform nodes about new nodes, changed nodes and removed nodes. Previously we sent the entire state of the network every time an update was due.&lt;/p&gt;
&lt;p&gt;While we have a pretty good &lt;a href="https://github.com/search?q=repo%3Ajuanfont%2Fheadscale+path%3A_test.go&amp;amp;type=code"&gt;test harness&lt;/a&gt; for validating our changes, the changes came down to &lt;a href="https://github.com/juanfont/headscale/compare/b01f1f1867136d9b2d7b1392776eb363b482c525...ed78ecd"&gt;284 changed files with 32,316 additions and 24,245 deletions&lt;/a&gt; and bugs are expected. We need help testing this release. In addition, while we think the performance should in general be better, there might be regressions in parts of the platform, particularly where we prioritised correctness over speed.&lt;/p&gt;
&lt;p&gt;There are also several bugfixes that has been encountered and fixed as part of implementing these changes, particularly
after improving the test harness as part of adopting &lt;a href="https://github.com/juanfont/headscale/pull/1460"&gt;#1460&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;BREAKING&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Code reorganisation, a lot of code has moved, please review the following PRs accordingly &lt;a href="https://github.com/juanfont/headscale/pull/1473"&gt;#1473&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Change the structure of database configuration, see &lt;a href="./config-example.yaml"&gt;config-example.yaml&lt;/a&gt; for the new structure. &lt;a href="https://github.com/juanfont/headscale/pull/1700"&gt;#1700&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Old structure has been remove and the configuration &lt;em&gt;must&lt;/em&gt; be converted.&lt;/li&gt;
&lt;li&gt;Adds additional configuration for PostgreSQL for setting max open, idle connection and idle connection lifetime.&lt;/li&gt;
&lt;li&gt;API: Machine is now Node &lt;a href="https://github.com/juanfont/headscale/pull/1553"&gt;#1553&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Remove support for older Tailscale clients &lt;a href="https://github.com/juanfont/headscale/pull/1611"&gt;#1611&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The oldest supported client is 1.42&lt;/li&gt;
&lt;li&gt;Headscale checks that &lt;em&gt;at least&lt;/em&gt; one DERP is defined at start &lt;a href="https://github.com/juanfont/headscale/pull/1564"&gt;#1564&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;If no DERP is configured, the server will fail to start, this can be because it cannot load the DERPMap from file or url.&lt;/li&gt;
&lt;li&gt;Embedded DERP server requires a private key &lt;a href="https://github.com/juanfont/headscale/pull/1611"&gt;#1611&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add a filepath entry to &lt;a href="https://github.com/juanfont/headscale/blob/b35993981297e18393706b2c963d6db882bba6aa/config-example.yaml#L95"&gt;&lt;code&gt;derp.server.private_key_path&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Docker images are now built with goreleaser (ko) &lt;a href="https://github.com/juanfont/headscale/pull/1716"&gt;#1716&lt;/a&gt; &lt;a href="https://github.com/juanfont/headscale/pull/1763"&gt;#1763&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Entrypoint of container image has changed from shell to headscale, require change from &lt;code&gt;headscale serve&lt;/code&gt; to &lt;code&gt;serve&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/lib/headscale&lt;/code&gt; and &lt;code&gt;/var/run/headscale&lt;/code&gt; is no longer created automatically, see &lt;a href="./docs/running-headscale-container.md"&gt;container docs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Prefixes are now defined per v4 and v6 range. &lt;a href="https://github.com/juanfont/headscale/pull/1756"&gt;#1756&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ip_prefixes&lt;/code&gt; option is now &lt;code&gt;prefixes.v4&lt;/code&gt; and &lt;code&gt;prefixes.v6&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prefixes.allocation&lt;/code&gt; can be set to assign IPs at &lt;code&gt;sequential&lt;/code&gt; or &lt;code&gt;random&lt;/code&gt;. &lt;a href="https://github.com/juanfont/headscale/pull/1869"&gt;#1869&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;MagicDNS domains no longer contain usernames &lt;a href=""&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This is in preperation to fix Headscales implementation of tags which currently does not correctly remove the link between a tagged device and a user. As tagged devices will not have a user, this will require a change to the DNS generation, removing the username, see &lt;a href="https://github.com/juanfont/headscale/issues/1369"&gt;#1369&lt;/a&gt; for more information.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;use_username_in_magic_dns&lt;/code&gt; can be used to turn this behaviour on again, but note that this option &lt;em&gt;will be removed&lt;/em&gt; when tags are fixed.&lt;ul&gt;
&lt;li&gt;dns.base_domain can no longer be the same as (or part of) server_url.&lt;/li&gt;
&lt;li&gt;This option brings Headscales behaviour in line with Tailscale.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;YAML files are no longer supported for headscale policy. &lt;a href="https://github.com/juanfont/headscale/pull/1792"&gt;#1792&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;HuJSON is now the only supported format for policy.&lt;/li&gt;
&lt;li&gt;DNS configuration has been restructured &lt;a href="https://github.com/juanfont/headscale/pull/2034"&gt;#2034&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Please review the new &lt;a href="./config-example.yaml"&gt;config-example.yaml&lt;/a&gt; for the new structure.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Use versioned migrations &lt;a href="https://github.com/juanfont/headscale/pull/1644"&gt;#1644&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Make the OIDC callback page better &lt;a href="https://github.com/juanfont/headscale/pull/1484"&gt;#1484&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;SSH support &lt;a href="https://github.com/juanfont/headscale/pull/1487"&gt;#1487&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;State management has been improved &lt;a href="https://github.com/juanfont/headscale/pull/1492"&gt;#1492&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Use error group handling to ensure tests actually pass &lt;a href="https://github.com/juanfont/headscale/pull/1535"&gt;#1535&lt;/a&gt; based on &lt;a href="https://github.com/juanfont/headscale/pull/1460"&gt;#1460&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix hang on SIGTERM &lt;a href="https://github.com/juanfont/headscale/pull/1492"&gt;#1492&lt;/a&gt; taken from &lt;a href="https://github.com/juanfont/headscale/pull/1480"&gt;#1480&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Send logs to stderr by default &lt;a href="https://github.com/juanfont/headscale/pull/1524"&gt;#1524&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix &lt;a href="https://tailscale.com/security-bulletins/#ts-2023-006"&gt;TS-2023-006&lt;/a&gt; security UPnP issue &lt;a href="https://github.com/juanfont/headscale/pull/1563"&gt;#1563&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Turn off gRPC logging &lt;a href="https://github.com/juanfont/headscale/pull/1640"&gt;#1640&lt;/a&gt; fixes &lt;a href="https://github.com/juanfont/headscale/issues/1259"&gt;#1259&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Added the possibility to manually create a DERP-map entry which can be customized, instead of automatically creating it. &lt;a href="https://github.com/juanfont/headscale/pull/1565"&gt;#1565&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add support for deleting api keys &lt;a href="https://github.com/juanfont/headscale/pull/1702"&gt;#1702&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add command to backfill IP addresses for nodes missing IPs from configured prefixes. &lt;a href="https://github.com/juanfont/headscale/pull/1869"&gt;#1869&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Log available update as warning &lt;a href="https://github.com/juanfont/headscale/pull/1877"&gt;#1877&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add &lt;code&gt;autogroup:internet&lt;/code&gt; to Policy &lt;a href="https://github.com/juanfont/headscale/pull/1917"&gt;#1917&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Restore foreign keys and add constraints &lt;a href="https://github.com/juanfont/headscale/pull/1562"&gt;#1562&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Make registration page easier to use on mobile devices&lt;/li&gt;
&lt;li&gt;Make write-ahead-log default on and configurable for SQLite &lt;a href="https://github.com/juanfont/headscale/pull/1985"&gt;#1985&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add APIs for managing headscale policy. &lt;a href="https://github.com/juanfont/headscale/pull/1792"&gt;#1792&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix for registering nodes using preauthkeys when running on a postgres database in a non-UTC timezone. &lt;a href="https://github.com/juanfont/headscale/issues/764"&gt;#764&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Make sure integration tests cover postgres for all scenarios&lt;/li&gt;
&lt;li&gt;CLI commands (all except &lt;code&gt;serve&lt;/code&gt;) only requires minimal configuration, no more errors or warnings from unset settings &lt;a href="https://github.com/juanfont/headscale/pull/2109"&gt;#2109&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CLI results are now concistently sent to stdout and errors to stderr &lt;a href="https://github.com/juanfont/headscale/pull/2109"&gt;#2109&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fix issue where shutting down headscale would hang &lt;a href="https://github.com/juanfont/headscale/pull/2113"&gt;#2113&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;e9d9c0773c6acd8db3e4a0759e0d2cd98163e696 Exclude irrelevant files from mkdocs rendering (#2136)&lt;/li&gt;
&lt;li&gt;ed78ecda12d86ffe115e4a10172376f887ac82a1 add shutdown that asserts if headscale had panics (#2126)&lt;/li&gt;
&lt;li&gt;6cbbcd859c815031730f035fd8f3ca90d05cf522 flake.lock: Update (#2135)&lt;/li&gt;
&lt;li&gt;10a72e8d542af68c0c280f2a6ccc84849719b24c update changelog for 0.23 release (#2138)&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.23.0" rel="alternate"/>
  </entry>
  <entry>
    <id>https://github.com/juanfont/headscale/releases/tag/v0.24.0</id>
    <title>New release for Headscale: v0.24.0</title>
    <updated>2025-01-17T06:58:05-05:00</updated>
    <author>
      <name>juanfont/headscale</name>
    </author>
    <content>&lt;h3&gt;Security fix: OIDC changes in Headscale 0.24.0&lt;/h3&gt;
&lt;p&gt;The following issue &lt;em&gt;only&lt;/em&gt; affects Headscale installations which authenticate
with OIDC.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Headscale v0.23.0 and earlier&lt;/em&gt; identified OIDC users by the "username" part of
their email address (when &lt;code&gt;strip_email_domain: true&lt;/code&gt;, the default) or whole
email address (when &lt;code&gt;strip_email_domain: false&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Depending on how Headscale and your Identity Provider (IdP) were configured,
only using the &lt;code&gt;email&lt;/code&gt; claim could allow a malicious user with an IdP account to
take over another Headscale user's account, even when
&lt;code&gt;strip_email_domain: false&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This would also cause a user to lose access to their Headscale account if they
changed their email address.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Headscale v0.24.0&lt;/em&gt; now identifies OIDC users by the &lt;code&gt;iss&lt;/code&gt; and &lt;code&gt;sub&lt;/code&gt; claims.
&lt;a href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimStability"&gt;These are guaranteed by the OIDC specification to be stable and unique&lt;/a&gt;,
even if a user changes email address. A well-designed IdP will typically set
&lt;code&gt;sub&lt;/code&gt; to an opaque identifier like a UUID or numeric ID, which has no relation
to the user's name or email address.&lt;/p&gt;
&lt;p&gt;Headscale v0.24.0 and later will also automatically update profile fields with
OIDC data on login. This means that users can change those details in your IdP,
and have it populate to Headscale automatically the next time they log in.
However, this may affect the way you reference users in policies.&lt;/p&gt;
&lt;p&gt;Headscale v0.23.0 and earlier never recorded the &lt;code&gt;iss&lt;/code&gt; and &lt;code&gt;sub&lt;/code&gt; fields, so all
legacy (existing) OIDC accounts &lt;em&gt;need to be migrated&lt;/em&gt; to be properly
secured.&lt;/p&gt;
&lt;h4&gt;What do I need to do to migrate?&lt;/h4&gt;
&lt;p&gt;Headscale v0.24.0 has an automatic migration feature, which is enabled by
default (&lt;code&gt;map_legacy_users: true&lt;/code&gt;). &lt;strong&gt;This will be disabled by default in a
future version of Headscale – any unmigrated users will get new accounts.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The migration will mostly be done automatically, with one exception. If your
OIDC does not provide an &lt;code&gt;email_verified&lt;/code&gt; claim, Headscale will ignore the
&lt;code&gt;email&lt;/code&gt;. This means that either the administrator will have to mark the user
emails as verified, or ensure the users verify their emails. Any unverified
emails will be ignored, meaning that the users will get new accounts instead
of being migrated.&lt;/p&gt;
&lt;p&gt;After this exception is ensured, make all users log into Headscale with their
account, and Headscale will automatically update the account record. This will
be transparent to the users.&lt;/p&gt;
&lt;p&gt;When all users have logged in, you can disable the automatic migration by
setting &lt;code&gt;map_legacy_users: false&lt;/code&gt; in your configuration file.&lt;/p&gt;
&lt;p&gt;Please note that &lt;code&gt;map_legacy_users&lt;/code&gt; will be set to &lt;code&gt;false&lt;/code&gt; by default in v0.25.0
and the migration mechanism will be removed in v0.26.0.&lt;/p&gt;
&lt;details&gt;

&lt;summary&gt;What does automatic migration do?&lt;/summary&gt;

##### What does automatic migration do?

When automatic migration is enabled (`map_legacy_users: true`), Headscale will
first match an OIDC account to a Headscale account by `iss` and `sub`, and then
fall back to matching OIDC users similarly to how Headscale v0.23.0 did:

- If `strip_email_domain: true` (the default): the Headscale username matches
  the "username" part of their email address.
- If `strip_email_domain: false`: the Headscale username matches the _whole_
  email address.

On migration, Headscale will change the account's username to their
`preferred_username`. **This could break any ACLs or policies which are
configured to match by username.**

Like with Headscale v0.23.0 and earlier, this migration only works for users who
haven't changed their email address since their last Headscale login.

A _successful_ automated migration should otherwise be transparent to users.

Once a Headscale account has been migrated, it will be _unavailable_ to be
matched by the legacy process. An OIDC login with a matching username, but
_non-matching_ `iss` and `sub` will instead get a _new_ Headscale account.

Because of the way OIDC works, Headscale's automated migration process can
_only_ work when a user tries to log in after the update.

Legacy account migration should have no effect on new installations where all
users have a recorded `sub` and `iss`.

&lt;/details&gt;

&lt;details&gt;

&lt;summary&gt;What happens when automatic migration is disabled?&lt;/summary&gt;

##### What happens when automatic migration is disabled?

When automatic migration is disabled (`map_legacy_users: false`), Headscale will
only try to match an OIDC account to a Headscale account by `iss` and `sub`.

If there is no match, it will get a _new_ Headscale account – even if there was
a legacy account which _could_ have matched and migrated.

We recommend new Headscale users explicitly disable automatic migration – but it
should otherwise have no effect if every account has a recorded `iss` and `sub`.

When automatic migration is disabled, the `strip_email_domain` setting will have
no effect.

&lt;/details&gt;

&lt;p&gt;Special thanks to @micolous for reviewing, proposing and working with us on
these changes.&lt;/p&gt;
&lt;h4&gt;Other OIDC changes&lt;/h4&gt;
&lt;p&gt;Headscale now uses
&lt;a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims"&gt;the standard OIDC claims&lt;/a&gt;
to populate and update user information every time they log in:&lt;/p&gt;
&lt;p&gt;| Headscale profile field | OIDC claim           | Notes / examples                                                                                          |
| ----------------------- | -------------------- | --------------------------------------------------------------------------------------------------------- |
| email address           | &lt;code&gt;email&lt;/code&gt;              | Only used when &lt;code&gt;"email_verified": true&lt;/code&gt;                                                                   |
| display name            | &lt;code&gt;name&lt;/code&gt;               | eg: &lt;code&gt;Sam Smith&lt;/code&gt;                                                                                           |
| username                | &lt;code&gt;preferred_username&lt;/code&gt; | Varies depending on IdP and configuration, eg: &lt;code&gt;ssmith&lt;/code&gt;, &lt;code&gt;ssmith@idp.example.com&lt;/code&gt;, &lt;code&gt;\\example.com\ssmith&lt;/code&gt; |
| profile picture         | &lt;code&gt;picture&lt;/code&gt;            | URL to a profile picture or avatar                                                                        |&lt;/p&gt;
&lt;p&gt;These should show up nicely in the Tailscale client.&lt;/p&gt;
&lt;p&gt;This will also affect the way you
&lt;a href="https://github.com/juanfont/headscale/pull/2205"&gt;reference users in policies&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;BREAKING&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Remove &lt;code&gt;dns.use_username_in_magic_dns&lt;/code&gt; configuration option
  &lt;a href="https://github.com/juanfont/headscale/pull/2020"&gt;#2020&lt;/a&gt;,
  &lt;a href="https://github.com/juanfont/headscale/pull/2279"&gt;#2279&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Having usernames in magic DNS is no longer possible.&lt;/li&gt;
&lt;li&gt;Remove versions older than 1.56
  &lt;a href="https://github.com/juanfont/headscale/pull/2149"&gt;#2149&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clean up old code required by old versions&lt;/li&gt;
&lt;li&gt;User gRPC/API &lt;a href="https://github.com/juanfont/headscale/pull/2261"&gt;#2261&lt;/a&gt;:&lt;/li&gt;
&lt;li&gt;If you depend on a Headscale Web UI, you should wait with this update until
    the UI have been updated to match the new API.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GET /api/v1/user/{name}&lt;/code&gt; and &lt;code&gt;GetUser&lt;/code&gt; have been removed in favour of &lt;code&gt;ListUsers&lt;/code&gt; with an ID parameter&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RenameUser&lt;/code&gt; and &lt;code&gt;DeleteUser&lt;/code&gt; now require an ID instead of a name.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Improved compatibility of built-in DERP server with clients connecting over
  WebSocket &lt;a href="https://github.com/juanfont/headscale/pull/2132"&gt;#2132&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Allow nodes to use SSH agent forwarding
  &lt;a href="https://github.com/juanfont/headscale/pull/2145"&gt;#2145&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed processing of fields in post request in MoveNode rpc
  &lt;a href="https://github.com/juanfont/headscale/pull/2179"&gt;#2179&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Added conversion of 'Hostname' to 'givenName' in a node with FQDN rules
  applied &lt;a href="https://github.com/juanfont/headscale/pull/2198"&gt;#2198&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed updating of hostname and givenName when it is updated in HostInfo
  &lt;a href="https://github.com/juanfont/headscale/pull/2199"&gt;#2199&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Fixed missing &lt;code&gt;stable-debug&lt;/code&gt; container tag
  &lt;a href="https://github.com/juanfont/headscale/pull/2232"&gt;#2232&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Loosened up &lt;code&gt;server_url&lt;/code&gt; and &lt;code&gt;base_domain&lt;/code&gt; check. It was overly strict in some
  cases. &lt;a href="https://github.com/juanfont/headscale/pull/2248"&gt;#2248&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CLI for managing users now accepts &lt;code&gt;--identifier&lt;/code&gt; in addition to &lt;code&gt;--name&lt;/code&gt;,
  usage of &lt;code&gt;--identifier&lt;/code&gt; is recommended
  &lt;a href="https://github.com/juanfont/headscale/pull/2261"&gt;#2261&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add &lt;code&gt;dns.extra_records_path&lt;/code&gt; configuration option &lt;a href="https://github.com/juanfont/headscale/issues/2262"&gt;#2262&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Support client verify for DERP &lt;a href="https://github.com/juanfont/headscale/pull/2046"&gt;#2046&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Add PKCE Verifier for OIDC &lt;a href="https://github.com/juanfont/headscale/pull/2314"&gt;#2314&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Changelog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ede4f97a16b0b2d357d3584431e9feb34d43fc89 Fix typos&lt;/li&gt;
&lt;li&gt;fa641e38b8a62ad665e15370a2b29a48c6486060 Set CSRF cookies for OIDC (#2328)&lt;/li&gt;
&lt;li&gt;1ab7b315a2707434b67cd83f28c6322a3c24b4c4 Update apple.md for latest version of iOS (#2321)&lt;/li&gt;
&lt;li&gt;38aef77e5419f7cc28f525226ed9567fe16dd166 allow @ and Log if OIDC username is not consider valid (#2340)&lt;/li&gt;
&lt;li&gt;b81420bef1e8d042f5bc126565c70b58f7321900 feat: Add PKCE Verifier for OIDC (#2314)&lt;/li&gt;
&lt;li&gt;caad5c613d90a11de1db4b93da69fa352a35c226 fix nil pointer deref (#2339)&lt;/li&gt;
&lt;li&gt;9313e5b058cb161927708e47622ef2bdef0ab9dc flake.lock: Update (#2313)&lt;/li&gt;
&lt;li&gt;f9bbfa5eabcbb0dc10866aada42f02a3602e1a8e flake.lock: Update (#2320)&lt;/li&gt;
&lt;li&gt;41bad2b9fdac7171e68babce0b6b045316d298f3 flake.lock: Update (#2324)&lt;/li&gt;
&lt;li&gt;610597bfb74145626a9169a11bc4ad7145246660 flake.lock: Update (#2342)&lt;/li&gt;
&lt;li&gt;e88406e8379691cae00fa82afbf52ecfacd5d292 set changelog date (#2347)&lt;/li&gt;
&lt;li&gt;e4a3dcc3b884bc5f37775df04389cba04bb5990b use headscale server url as domain instead of base_domain (#2338)&lt;/li&gt;
&lt;/ul&gt;</content>
    <link href="https://github.com/juanfont/headscale/releases/tag/v0.24.0" rel="alternate"/>
  </entry>
</feed>
